@page "/tipo-productos-archivados"
@using Onlyou.Client.Shared
@using Onlyou.Shared.DTOS.TipoProducto
@inject IHttpServicios http
@inject NavigationManager nav
@inject SweetAlertService swal

<h3>Productos Archivados</h3>

<TablaArchivados TDTO="GetTipoProductoDTO"
				 Items="TProductoArchivados"
				 Columnas="columnas"
				 OnRestaurar="RestaurarProducto"
				 OnEliminar="EliminarProducto" />

@code {
	private List<GetTipoProductoDTO> TProductoArchivados = new();
	private List<string> columnas = new() { "Nombre" };

	protected override async Task OnInitializedAsync()
	{
		// consume endpoint del server y devuelve los archivados
		TProductoArchivados = (await http.Get<List<GetTipoProductoDTO>>("api/TipoProducto/Archivados")).Respuesta ?? new();
	}

	private async Task RestaurarProducto(GetTipoProductoDTO productoDTO)
	{
		await http.Put<object>($"api/TipoProducto/Archivados/{productoDTO.Id}", null);
		await swal.FireAsync("Exito", "Tipo Producto Restaurado exitosamente", SweetAlertIcon.Success);
		TProductoArchivados.Remove(productoDTO);
		StateHasChanged();
	}

	private async Task EliminarProducto(GetTipoProductoDTO productoDTO)
	{

		var confirm = await swal.FireAsync(new SweetAlertOptions
		{
			Title = "Confirmar",
			Text = $"¿Seguro que deseas Eliminar el Tipo Producto {productoDTO.Nombre}?",
			Icon = SweetAlertIcon.Question,
			ShowCancelButton = true,
			ConfirmButtonText = "Sí",
			CancelButtonText = "Cancelar"
		});

		if (confirm.IsConfirmed)
		{
			await http.Delete($"api/TipoProducto/EliminarTipoProducto/{productoDTO.Id}");
			TProductoArchivados.Remove(productoDTO);
			StateHasChanged();
		}

	}
}
